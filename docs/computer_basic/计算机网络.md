# 计算机网络

## 总览

### TCP/IP模型

- 应用层：
  - 提供应用服务
  - HTTP/FTP协议
- 传输层：
  - 为应用提供数据传输服务，应用（端）之间的通信，通过端口区分应用
  - TCP/UDP协议
- 网络层：
  - 设备之间的通信，通过ip地址标识主机（设备）
  - ip地址包含信息：子网号 + 主机号，子网号通过子网掩码计算得到
  - IP协议：寻址 + 路由
    - 寻址：通过ip地址找到对应的子网和主机，确认目的地
    - 路由：路由器根据ip地址确认转发路径
- 数据链路层：
  - 物理链路之间通信（这里的端指：以太网接口，一台设备拥有多个接口，而一台设备只有一个ip地址，需要MAC地址区分接同一设备的不同接口）
  - ARP协议：根据IP地址确认MAC地址

### 键入网址到网页显示，期间发生了什么？

浏览器输入URL后：

1. 浏览器读取URL，通过URL获取以下信息
   - 协议：http / https
   - 服务器名字（域名）
   - 服务器上的资源路径
2. 应用程序打包http请求报文
3. DNS域名解析
   - 应用程序打包http请求报文后，需要将其交给操作系统中的协议栈，协议栈除了需要http请求报文，还需要ip地址
   - DNS域名解析的作用就是将域名解析为对应的ip地址
4. 协议栈工作：生成网络包
   1. 协议栈包含了TCP/UDP协议、IP协议、ICMP协和ARP协议（http报文使用TCP协议）。也就是说协议栈包含了传输层和网络层
   2. TCP/UDP协议：添加TCP/UDP头部，在TCP中如果http报文超出MSS，会对其进行切割
   3. IP协议：添加IP头部，如果网络包超过MTU（通常为1500字节），会在网络层分片。
      - 维护一个路由表（Linux `route -n`查看）
      - 路由表记录：目标ip地址（子网）+ 网关地址 + 子网掩码 + 路由器转发端口 + 网卡名
        - 目标ip地址（子网）和子网掩码均为0.0.0.0为默认网关，默认网关ip地址为 网关地址列下的 ip地址。匹配默认网关会将网络包转发到默认网关地址
        - 如果匹配的不是默认网关
          - 如果网关地址为空，说明当前路由器就在ip包中的子网地址，不需路由器转发，接下来交给mac
          - 如果网关地址不为空，说明当前路由器不在ip包中的子网地址，需要路由器继续转发到其他子网
   4. 添加MAC头部，通过ARP缓存获取MAC地址，如果不知道接收方的MAC地址，通过ARP协议获取
      - 维护一个arp缓存（Linux `arp -a`查看）
      - arp缓存记录：ip地址 + mac地址 + 以太网接口
   5. 生成网络包
5. 网卡驱动和网卡：将网络包转换成电信号在网线上发出
   1. 网卡驱动控制网卡，将网络包拷贝到网卡缓存区，开头加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列。
   2. 网卡将包转换成电信号发送出去

**交换机**

两层交换设备，没有ip地址和mac地址

接收所有mac地址的包

维护mac地址表

- 一个是设备的 MAC 地址，
- 另一个是该设备连接在交换机的哪个端口上

根据mac地址表判断转发到交换机的哪个端口

如果mac地址表找不到对应条目，则广播（除了源端口，将以太网包转发到其他端口），目标主机接收到后会发送响应包，从而更新mac地址表

**路由器**

三层交换设备，每个路由器端口都有自己的ip地址和mac地址

和自己mac地址不符的包丢弃

维护路由表和arp缓存

- 根据路由表判断转发到路由器的哪个端口
- 如果当前路由器在目标子网，则通过arp缓存查询目标mac地址，找不到则通过广播获取mac地址

## HTTP

### 简介

HTTP（HyperText Transfer Protocol，超文本传输协议）

- 超文本：超越文本的文本，如图片、文字、视频以及**超链接**
- 传输：双向传播
- 协议：遵守的行为规范

HTTP是计算机之间传输超文本之间的双向行为规范

### 状态码

![ 五大类 HTTP 状态码 ](/Users/t/Desktop/xxxx2077.github.io/docs/computer_basic/计算机网络.assets/6-五大类HTTP状态码.png)

常用状态码：

- `2xx`
  - `200 OK` 最常见的成功状态码
  - `204 No Content`响应没有body数据
  - `206 Partial Content`返回的body为部分数据，不是全部（常见于HTTP分块上传或断点续传）
- `3xx`重定向： 客户申请的资源发生了变动，需要使用新的URL请求获取资源
  - `301 Moved Permanently`永久重定向，请求的资源不存在了，需要用新的URL请求访问
  - `302 Found`暂时重定向，请求的资源还在，但需要用新的URL请求访问
  - `304 Not Modified`使用缓存

## TCP